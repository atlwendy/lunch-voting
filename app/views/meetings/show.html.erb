<p id="notice"><%= notice %></p>

<p>
  <strong>Title:</strong>
  <%= @meeting.title %>
</p>

<p>
  <strong>Description:</strong>
  <%= @meeting.description %>
</p>

<p>
  <strong>Date:</strong>
  <%= @meeting.date %>
</p>

<p>
  <strong>Members</strong> 
  (<%= link_to 'edit', :select_members %>)
  <strong>:</strong>
  <ul>
  <% @meeting.users.each do |user| %>
  <li><%= link_to user.username, user %></li>
  <% end %>
  </ul>
</p>

<p>
  <div id="editr">
	<strong>Restaurants</strong>
	(<%= link_to 'edit restaurant', :select_restaurants%>)
	<strong>:</strong>
</div>
	<table class='vote' id='editr'>
		<% @meeting.restaurants.each do |rest|%>
		  <tr>
        <td class="arrow-up" id="uparrow" onclick="changevote('up', '<%=@user%>')"></td>
        <td rowspan="3" class="restname"><%= link_to rest.name, rest%></td>
      </tr>
      <tr>
        <td class="votenumber" id="vnumber"><%=@votes%></td>
      </tr>
      <tr>
        <td class="arrow-down" id="downarrow" onclick="changevote('down', '<%=@user%>')"></td>
      </tr>
        
		<% end %>
	</table>
		

<%= link_to 'Edit', edit_meeting_path(@meeting) %> |
<%= link_to 'Back', meetings_path %>

<script>
function changevote(direction, user){
  if (! user) { 
    $("#editr").append("<div style='color: red'>You have to login first to vote!</div>");
    return
  }
  var votes;
  votes = parseInt($("#vnumber").html());
  updateVoteDB('direction')
}

function updateVoteDB(vote) {
  var uid = '<%=@uid%>';
  var mrs_id = '<%=@mrs_id%>';
  var vote = vote;
  
  $.ajax({
            url:        "../meetings/updateVoteDB",
            type:       "GET",
            data:       {uid: uid, mrs_id:mrs_id, vote:vote},
            datatype:   "json",
            complete:   function (xhr, status) {
                        }, 
            success:    function(data, textStatus, xhr){
                          if (data) {
                            counts = parseInt($("#vnumber").html());
                            if (vote == 'up') {
                              ++counts;
                              $("#uparrow").addClass('arrow-uped').removeClass('arrow-up');
                              if ($("#downarrow").hasClass('arrow-downed')) {
                                $("#downarrow").addClass('arrow-down').removeClass('arrow-downed');
                              }
                            }
                            else {
                              if (counts > 0) {
                                --counts;
                                $("#downarrow").addClass('arrow-downed').removeClass('arrow-down');
                                if ($("#uparrow").hasClass('arrow-uped')) {
                                  $("#uparrow").addClass('arrow-up').removeClass('arrow-uped');
                                 }
                              }
                            }
                            $("#vnumber").html(votes);
                          }                
                          else {
                            alert("Something went wrong. Please contact your admin")
                          }
                        },
            error:      function(request, status, error){
                            console.log(error)
                            console.log(status)
                        },
            });
}
</script>